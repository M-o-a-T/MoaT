#include "fakebus/crc11.h"
#include <stdio.h>

/*
 * This code implements a lookup-based CRC for polynomial 0xAC9A.
 *
 * 11-bit CRC tables are not part of this code, they're generated on the fly.
 */

// table generated by running "moatbus/crc.py"

static const u_int16_t table11[] = {
0, 1468, 411, 1063, 822, 1674, 685, 1809, 1644, 976, 2039, 587, 1370, 230, 1217, 381, 1595, 903, 1952, 540, 1293, 177, 1174, 298, 87, 1515, 460, 1136, 865, 1757, 762, 1862, 1685, 809, 1806, 690, 1443, 31, 1080, 388, 249, 1349, 354, 1246, 975, 1651, 596, 2024, 174, 1298, 309, 1161, 920, 1572, 515, 1983, 1730, 894, 1881, 741, 1524, 72, 1135, 467, 1993, 629, 1618, 1006, 1279, 323, 1380, 216, 421, 1049, 62, 1410, 659, 1839, 776, 1716, 498, 1102, 105, 1493, 708, 1912, 863, 1763, 1950, 546, 1541, 953, 1192, 276, 1331, 143, 348, 1248, 199, 1403, 618, 2006, 1009, 1613, 1840, 652, 1707, 791, 1030, 442, 1437, 33, 1895, 731, 1788, 832, 1105, 493, 1482, 118, 267, 1207, 144, 1324, 573, 1921, 934, 1562, 1393, 205, 1258, 342, 1607, 1019, 2012, 608, 797, 1697, 646, 1850, 43, 1431, 432, 1036, 842, 1782, 721, 1901, 124, 1472, 487, 1115, 1318, 154, 1213, 257, 1552, 940, 1931, 567, 996, 1624, 639, 1987, 210, 1390, 329, 1269, 1416, 52, 1043, 431, 1726, 770, 1829, 665, 1503, 99, 1092, 504, 1769, 853, 1906, 718, 947, 1551, 552, 1940, 133, 1337, 286, 1186, 696, 1796, 803, 1695, 398, 1074, 21, 1449, 1236, 360, 1359, 243, 2018, 606, 1657, 965, 1155, 319, 1304, 164, 1973, 521, 1582, 914, 751, 1875, 884, 1736, 473, 1125, 66, 1534, 1069, 401, 1462, 10, 1819, 679, 1664, 828, 577, 2045, 986, 1638, 375, 1227, 236, 1360, 534, 1962, 909, 1585, 288, 1180, 187, 1287, 1146, 454, 1505, 93, 1868, 752, 1751, 875
};

//CRC(0x571,11,8)

u_int16_t crc11_update(u_int16_t crc, u_int8_t byte)
{
    crc = table11[(byte ^ crc) & 0xFF] ^ (crc>>8);
    return crc;
}

