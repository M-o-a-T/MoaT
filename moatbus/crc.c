#include "crc.h"
#include <stdio.h>

/*
 * This code implements a lookup-based CRC for polynomial 0xAC9A.
 *
 * 11-bit CRC tables are not part of this code, they're generated on the fly.
 */

// table generated by running "moatbus/crc.py"

static const u_int16_t table16[] = {
0, 31062, 62124, 35834, 48237, 50491, 20161, 14231, 8687, 22713, 54083, 43541, 40322, 58580, 28462, 5752, 17374, 14984, 45426, 51236, 65459, 34533, 3359, 29769, 25137, 7015, 37021, 59851, 56924, 42762, 11504, 21926, 34748, 65258, 29968, 3142, 15313, 17031, 51581, 45099, 42579, 57093, 21759, 11689, 6718, 25448, 59538, 37316, 50274, 48436, 14030, 20376, 30735, 345, 35491, 62453, 58765, 40155, 5921, 28279, 23008, 8374, 43852, 53786, 22093, 12059, 42209, 56759, 59936, 37750, 6284, 25050, 30626, 3828, 34062, 64600, 52175, 45721, 14691, 16437, 5523, 27845, 59199, 40553, 43518, 53416, 23378, 8708, 13436, 19754, 50896, 49030, 34833, 61767, 31421, 1003, 53745, 43175, 9053, 23051, 28060, 5322, 40752, 58982, 61470, 35144, 690, 31716, 19571, 13605, 48863, 51081, 37423, 60281, 24707, 6613, 11842, 22292, 56558, 42424, 46016, 51862, 16748, 14394, 4013, 30459, 64769, 33879, 44186, 54732, 24118, 10080, 4343, 27041, 57947, 39693, 36213, 62499, 32729, 1679, 12568, 18510, 50100, 47842, 61252, 38418, 7656, 25790, 21289, 10879, 41349, 55507, 52907, 47101, 15367, 17745, 29382, 2960, 32874, 63804, 11046, 21104, 55690, 41180, 38731, 60957, 26087, 7345, 2761, 29599, 63589, 33075, 46756, 53234, 17416, 15710, 26872, 4526, 39508, 58114, 54421, 44483, 9785, 24431, 18711, 12353, 48059, 49901, 62842, 35884, 2006, 32384, 64215, 33665, 2171, 28973, 18106, 16364, 46102, 52544, 56120, 41582, 10644, 20674, 26453, 7683, 38393, 60591, 47369, 49247, 19365, 13043, 1380, 31794, 63432, 36510, 39142, 57776, 27210, 4892, 9355, 24029, 54823, 44913, 32107, 1085, 36807, 63121, 49414, 47184, 13226, 19196, 23684, 9682, 44584, 55166, 57577, 39359, 4677, 27411, 16053, 18403, 52249, 46415, 33496, 64398, 28788, 2338, 8026, 26124, 60918, 38048, 41783, 55905, 20891, 10445
};

//CRC(0xAC9A,16,8)

u_int16_t crc16_update(u_int16_t crc, u_int8_t byte)
{
    crc = table16[(byte ^ crc) & 0xFF] ^ (crc>>8);
    return crc;
}

